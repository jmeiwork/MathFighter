<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <style>
        #matchAreaContainer{
            padding: 5px;
            margin: 0;
            /*border: dashed 1px #bbbbbb;*/
        }

        #equation, #wasCorrect, #myAnswer{
            width: 100px;
            float: left;
        }

        #btnStart{
            margin: 5px;
        }

        #announcements{
            clear: both;
        }

    </style>
</head>
<body>
    <!--
    <div><span>type your message:</span><span><input type="text" id="txtMessage" /></span></div>
    <div><button id="btnSend">Send</button></div>
    <div id="messages"></div>
    -->
    <div><span>type the group you want to join:</span><span><input type="text" id="txtGroup" /></span><button id="btnJoin">Send</button></div>

    <button id="btnStart">Start</button>
    <div><input type="text" id="txtAnswer" /></div>
    <button id="btnNextEquation">Next Question</button>

    <div id="matchAreaContainer">
        <div id="equation"></div>
        <div id="myAnswer"></div>
        <div id="wasCorrect"></div>

        <table id="history"><tr id="tr"></tr></table>
    </div>



    <input type="hidden" id="hidQuestionCode" />

    <div id="announcements"></div>
    <script src="Scripts/jquery-1.6.4.js"></script>
    <script src="Scripts/jquery.signalR-2.0.3.js"></script>
    <script src="/signalr/hubs"></script>
    <script>
        $(function () {
            var playHub = $.connection.playHub;
            var questionBeingAnswered = "";
            $("#txtAnswer").hide();
            $("#btnNextEquation").hide();


            playHub.client.newJoinAnnouncement = function (message) {
                $("#announcements").append("<div>" + message + "</div>");
            }

            playHub.client.newMessage = function (data) {
                $("#messages").append("<div>" + data + "</div>");
            }

            //----------------------
            playHub.client.newQuestionWithCorrectness = function (connectionId, data, previousWasCorrect) {
                $("#hidQuestionCode").val(data.QuestionCode);
                //$("#equation").prepend("<div>" + data.EquationString + "</div>");

                if (previousWasCorrect) {
                    //$("#wasCorrect").prepend("<div>Correct!</div>");
                    $("#" + questionBeingAnswered).append("<td>Correct!</td>");
                }
                else {
                    //$("#wasCorrect").prepend("<div>WRONG!</div>");
                    $("#"+questionBeingAnswered).append("<td>WRONG!!</td>");
                }

                $("#history").prepend("<tr id='" + data.QuestionId + "'><td>" + data.EquationString + "</td></tr>");
                questionBeingAnswered = data.QuestionId;

            }

            playHub.client.newQuestion = function (connectionId, data) {
                $("#hidQuestionCode").val(data.QuestionCode);
                //$("#equation").prepend("<div>" + data.EquationString + "</div>");
                $("#history").prepend("<tr id='"+data.QuestionId+"'><td>"+data.EquationString+"</td></tr>");
                questionBeingAnswered = data.QuestionId;
            }


            $.connection.hub.start().done(function () {
                $("#btnSend").click(function () {
                    var data = $("#txtMessage").val();
                    playHub.server.sendMessageForRoom(
                        $("#txtGroup").val(),
                         data
                    );
                });

                $("#btnJoin").click(function () {
                    var group = $("#txtGroup").val();
                    playHub.server.joinRoom(group);
                });

                //---------------
                $("#btnNextEquation").click(function () {
                    var answer = $("#txtAnswer").val();
                    var questionCode = $("#hidQuestionCode").val();
                    //$("#myAnswer").prepend("<div>" + answer + "</div>");
                    $("#" + questionBeingAnswered).append("<td>" + answer + "</td>");
                    playHub.server.submitAnswer($("#txtGroup").val(), questionCode, answer);
                })

                $("#txtAnswer").keyup(function (e) {
                    var code = e.which;
                    if (code == 13) //enter key
                    {
                        $("#btnNextEquation").click();
                        $("#txtAnswer").val("");
                    }
                });

                $("#btnStart").click(function () {
                    $("#btnStart").hide();
                    $("#txtAnswer").show();
                    $("#txtAnswer").focus();
                    $("#btnNextEquation").show();

                    playHub.server.start($("#txtGroup").val());
                });

            });

        });

    </script>
</body>


</html>
